---

- name: install ansible tower
  hosts: all
  become: yes
  pre_tasks:
    - name: add hosts to tower group
      add_host:
        name: "{{ item }}"
        ansible_host: "{{ hostvars[item].ansible_host }}"
        ansible_port: "{{ hostvars[item].ansible_port }}"
        groups: tower
      loop: "{{ ansible_play_hosts }}"
  roles:
  - ansible-role-rhn
  - linux-common
  - role: ansible-tower
    tower_pass: "{{ lookup('env', 'TOWER_PASSWORD') }}"
  - tower-post-install